<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¹¾å¤å¥ªé‡‘å¤§å¸«</title>
    <style>
        :root { --gold: #fbc531; --magic: #4834d4; --red: #b33939; --dark: #161625; --ancient: #009432; }
        body { background:#0a0a1a; color:white; font-family:'PingFang TC', sans-serif; text-align:center; padding:10px; margin:0; line-height:1.5; }
        .box { background: linear-gradient(160deg, #161625, #2c3e50); border: 3px solid var(--gold); border-radius: 20px; padding: 15px; max-width: 450px; margin: 10px auto; box-shadow: 0 0 20px rgba(251, 197, 49, 0.2); }
        h1 { color: var(--gold); font-size: 24px; margin: 10px 0; text-shadow: 0 0 10px rgba(251,197,49,0.6); font-weight: 900; letter-spacing: 2px; }
        .subtitle { font-size: 10px; color: #f5f6fa; margin-bottom: 15px; border: 1px solid var(--gold); padding: 5px; border-radius: 5px; display: inline-block; background: rgba(179, 57, 57, 0.3); font-weight: bold; }
        .section-title { background: var(--red); color: white; padding: 5px 10px; border-radius: 5px; font-size: 14px; margin: 15px 0 10px; font-weight: bold; border-left: 5px solid var(--gold); text-align: left; }
        label { display: block; text-align: left; color: #dcdde1; font-size: 13px; margin: 8px 0 3px; }
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: none; font-size: 16px; margin-bottom: 5px; box-sizing: border-box; background: #f5f6fa; color: #333; font-weight: bold; }
        
        .btn { width: 100%; padding: 18px; background: linear-gradient(to right, #f1c40f, #f39c12); color: #2c3e50; border: none; border-radius: 12px; font-weight: 900; font-size: 18px; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 0 #b8860b; transition: 0.1s; }
        .btn:active { transform: translateY(3px); box-shadow: none; }
        .btn-history { background: #8e44ad; color: white; padding: 12px; font-size: 16px; box-shadow: 0 4px 0 #5e3370; margin-top: 10px; }
        
        #res { display:none; margin-top: 25px; text-align: left; animation: slideIn 0.6s; }
        @keyframes slideIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
        .card { background: rgba(255, 255, 255, 0.95); color: #333; padding: 15px; border-radius: 15px; margin-bottom: 15px; border-left: 8px solid var(--magic); }
        .card-h { font-weight: 900; color: var(--red); border-bottom: 1px dashed #ccc; padding-bottom: 5px; margin-bottom: 10px; font-size: 16px; display: flex; justify-content: space-between; align-items: center; }
        
        .tags-container { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 10px; justify-content: center; }
        .sys-tag { background: #333; color: white; font-size: 10px; padding: 3px 6px; border-radius: 4px; border: 1px solid #666; }
        .tag-east { border-color: #c0392b; color: #ff7675; }
        .tag-west { border-color: #4834d4; color: #a29bfe; }
        .tag-nord { border-color: #0984e3; color: #74b9ff; }
        .tag-maya { border-color: #009432; color: #55efc4; }
        .tag-time { border-color: #f39c12; color: #f1c40f; font-weight: bold; }
        
        .score-board { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; background: #e8e8e8; border-radius: 8px; padding: 10px; margin: 10px 0; font-size: 12px; border: 1px solid #ccc; text-align: center; }
        .score-item { background: white; padding: 5px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); font-weight: bold; }
        
        .ana-box { background: #f0f0f5; padding: 10px; border-radius: 8px; font-size: 13px; color: #444; margin-top: 10px; border: 1px dashed #aaa; line-height: 1.6; }
        .score-box { text-align: center; padding: 15px; border-radius: 10px; color: white; font-weight: bold; font-size: 18px; margin-top: 10px; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
        
        .num-ball { display: inline-block; background: radial-gradient(circle at 30% 30%, #ff4d4d, #b33939); color: white; width: 60px; height: 60px; line-height: 60px; text-align: center; border-radius: 50%; margin: 10px auto; font-weight: 900; border: 3px solid var(--gold); font-size: 28px; box-shadow: 0 4px 10px rgba(0,0,0,0.4); }
        .recommend-title { font-weight: bold; color: #2c3e50; margin-top: 15px; border-top: 1px solid #ccc; padding-top: 10px; text-align: center; }
        
        #historyBox { display:none; background: #2c3e50; padding: 15px; border-radius: 15px; margin-top: 15px; border: 2px solid #8e44ad; text-align: left; }
        .hist-item { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-bottom: 8px; font-size: 13px; border-left: 4px solid var(--gold); }
        .hist-time { font-size: 11px; color: #aaa; }
        .clear-btn { background: #c0392b; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; float: right; font-size: 12px; }

        /* å³æ™‚é›»å­é˜æ¨£å¼ */
        #realTimeClock { background: rgba(0,0,0,0.6); color: #fbc531; padding: 2px 6px; border-radius: 5px; font-family: monospace; font-size: 14px; margin-left: 5px; border: 1px solid #fbc531; letter-spacing: 1px; }
    </style>
</head>
<body>

<div class="box">
    <h1>ğŸª ä¹¾å¤å¥ªé‡‘å¤§å¸«</h1>
    <div class="subtitle">ğŸŒ å…¨çƒç¥ç¥•å­¸å…±æŒ¯ â• æ“‡æ—¥æ“‡æ™‚é çŸ¥ç³»çµ±</div>
    
    <div class="section-title">ğŸ‘¤ ç¬¬ä¸€æ­¥ï¼šå»ºæ§‹æœ¬å‘½ç£å ´</div>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>å§“å</label><input type="text" id="uName" placeholder="è¼¸å…¥å§“å"></div>
        <div style="flex:1;"><label>æ€§åˆ¥</label><select id="uGender"><option value="ç”·">ä¹¾(ç”·)</option><option value="å¥³">å¤(å¥³)</option></select></div>
    </div>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>ç”Ÿæ—¥</label><input type="date" id="bDate"></div>
        <div style="flex:1;"><label>æ™‚è¾°</label>
            <select id="bHour">
                <option value="24">æœªçŸ¥ (ç”±å®‡å®™è§¸æ©Ÿå®šç›¤)</option>
                <option value="0">å­(23-01)</option><option value="2">ä¸‘(01-03)</option><option value="4">å¯…(03-05)</option><option value="6">å¯(05-07)</option>
                <option value="8">è¾°(07-09)</option><option value="10">å·³(09-11)</option><option value="12">åˆ(11-13)</option><option value="14">æœª(13-15)</option>
                <option value="16">ç”³(15-17)</option><option value="18">é…‰(17-19)</option><option value="20">æˆŒ(19-21)</option><option value="22">äº¥(21-23)</option>
            </select>
        </div>
    </div>

    <div class="section-title">ğŸ« ç¬¬äºŒæ­¥ï¼šå…¨çƒå…¬å¯©ç›®æ¨™æª¢å®š</div>
    <label>é¸æ“‡ç›®æ¨™æ¬¾å¼èˆ‡é¢é¡</label>
    <select id="tSelect" style="border: 2px solid var(--red);" onchange="updateMaxNum()">
        <option value="0_å…¨å“é …ç¶œåˆé‹å‹¢">âœ¨ ã€ä¸æŒ‡å®šæ¬¾å¼ã€‘ æ¸¬ç®—ç›®æ¨™æ™‚è¾°æ•´é«”é‹å‹¢ âœ¨</option>
        <optgroup label="2000å…ƒé¢é¡">
            <option value="2000_2,000è¬è¶…ç´šç´…åŒ…">ã€2000å…ƒã€‘ 2,000è¬è¶…ç´šç´…åŒ…</option>
        </optgroup>
        <optgroup label="1000å…ƒé¢é¡">
            <option value="1000_1,200è¬å¤§å‰åˆ©">ã€1000å…ƒã€‘ 1,200è¬å¤§å‰åˆ©</option>
        </optgroup>
        <optgroup label="500å…ƒé¢é¡">
            <option value="500_äº”è·¯è²¡ç¥">ã€500å…ƒã€‘ äº”è·¯è²¡ç¥</option>
            <option value="500_å“ˆå•¾å’ª">ã€500å…ƒã€‘ å“ˆå•¾å’ª</option>
            <option value="500_é‡‘é¦¬çï¼ˆ100%ä¸­çï¼‰">ã€500å…ƒã€‘ é‡‘é¦¬çï¼ˆ100%ä¸­çï¼‰</option>
            <option value="500_é‡‘ç‰Œ777">ã€500å…ƒã€‘ é‡‘ç‰Œ777</option>
        </optgroup>
        <optgroup label="300å…ƒé¢é¡">
            <option value="300_æµ·åº•å¤§å°‹å¯¶">ã€300å…ƒã€‘ æµ·åº•å¤§å°‹å¯¶</option>
        </optgroup>
        <optgroup label="200å…ƒé¢é¡">
            <option value="200_é‡‘é¦¬å ±å–œ">ã€200å…ƒã€‘ é‡‘é¦¬å ±å–œ</option>
            <option value="200_é‡‘å¥½é‘½">ã€200å…ƒã€‘ é‡‘å¥½é‘½</option>
            <option value="200_å¥½é‹é€£ç™¼">ã€200å…ƒã€‘ å¥½é‹é€£ç™¼</option>
            <option value="200_å¤§ä¸‰å…ƒ">ã€200å…ƒã€‘ å¤§ä¸‰å…ƒ</option>
        </optgroup>
        <optgroup label="100å…ƒé¢é¡">
            <option value="100_æ¨é‡‘å¹£">ã€100å…ƒã€‘ æ¨é‡‘å¹£</option>
            <option value="100_è²¡ç¥å ±åˆ°">ã€100å…ƒã€‘ è²¡ç¥å ±åˆ°</option>
            <option value="100_è²¡æºæ»¾æ»¾">ã€100å…ƒã€‘ è²¡æºæ»¾æ»¾</option>
        </optgroup>
    </select>
    
    <label>ç›®æ¨™è™Ÿç¢¼å°¾æ•¸ (é¸å¡«)</label>
    <input type="number" id="tNum" min="0" max="100" placeholder="è¼¸å…¥å°¾æ•¸ 0~100 (æ²’æƒ³æ³•å¯ä¸å¡«)">

    <div class="section-title" style="background: #27ae60; border-left-color: #f1c40f;">â³ ç¬¬ä¸‰æ­¥ï¼šè¨­å®šèµ·å¦æ™‚é–“</div>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;">
            <label>é è¨ˆè³¼è²·æ—¥ (é è¨­ä»Šå¤©)</label>
            <input type="date" id="buyDate">
        </div>
        <div style="flex:1;">
            <label>è³¼è²·æ™‚è¾° <span id="realTimeClock">00:00:00</span></label>
            <select id="buyHour">
                <option value="auto">âœ¨ è‡ªå‹•åµæ¸¬ç•¶ä¸‹æ™‚è¾°</option>
                <option value="0">å­æ™‚ (23-01)</option>
                <option value="2">ä¸‘æ™‚ (01-03)</option>
                <option value="4">å¯…æ™‚ (03-05)</option>
                <option value="6">å¯æ™‚ (05-07)</option>
                <option value="8">è¾°æ™‚ (07-09)</option>
                <option value="10">å·³æ™‚ (09-11)</option>
                <option value="12">åˆæ™‚ (11-13)</option>
                <option value="14">æœªæ™‚ (13-15)</option>
                <option value="16">ç”³æ™‚ (15-17)</option>
                <option value="18">é…‰æ™‚ (17-19)</option>
                <option value="20">æˆŒæ™‚ (19-21)</option>
                <option value="22">äº¥æ™‚ (21-23)</option>
            </select>
        </div>
    </div>

    <button class="btn" onclick="go()">ğŸŒ å•Ÿå‹•ä¸–ç•Œç´šå…±æŒ¯ç›¤ç®—ï¼</button>
    
    <button class="btn btn-history" onclick="toggleHistory()">ğŸ“œ æŸ¥çœ‹æ­·å²å¥ªé‡‘ç´€éŒ„</button>

    <div id="historyBox">
        <h3 style="margin: 0 0 10px 0; color: var(--gold);">ğŸ“œ æ­·å²æª¢å®šç´€éŒ„ <button class="clear-btn" onclick="clearHistory()">æ¸…ç©º</button></h3>
        <div id="historyList"></div>
    </div>

    <div id="res">
        <div class="card" style="border-left-color: #f1c40f;">
            <div class="card-h">ğŸŒ å…¨çƒç¥ç¥•å­¸å¤§å¯©åˆ¤çµæœ</div>
            <div style="font-size:14px; text-align:center;">
                æ¸¬ç®—ç›®æ¨™ï¼š <b style="color:#d35400;" id="r_target_info"></b>
            </div>
            
            <div class="tags-container" id="o_magic_tags"></div>

            <div class="score-board">
                <div class="score-item" style="color: #c0392b;">â˜¯ï¸ æ±æ–¹: <span id="s_east"></span>/25</div>
                <div class="score-item" style="color: #4834d4;">ğŸ”® è¥¿æ–¹: <span id="s_west"></span>/25</div>
                <div class="score-item" style="color: #0984e3;">áš± åŒ—æ­: <span id="s_nord"></span>/25</div>
                <div class="score-item" style="color: #009432;">ğŸ¦… è–©æ»¿: <span id="s_maya"></span>/25</div>
            </div>

            <div id="o_score_box" class="score-box"></div>
            <div class="ana-box" id="o_target_ana"></div>
            
            <div class="recommend-title" id="t_recommend_title">ğŸ‘‡ å®‡å®™å…±æŒ¯å°ˆå±¬å°¾æ•¸ ğŸ‘‡</div>
            <div style="text-align:center;"><div class="num-ball" id="o_lucky_num_1"></div></div>
        </div>

        <div class="card" style="border-left-color: #27ae60;">
            <div class="card-h">ğŸ’¡ è“‹äºæ„è­˜æœ€æ¨è–¦æ–¹æ¡ˆ</div>
            <div style="font-size:13px; margin-bottom:5px;">ç¶œåˆå››å¤§ç³»çµ±èˆ‡æ‚¨é¸å®šçš„æ™‚è¾°ï¼Œæœ€æ—ºæ¬¾å¼ï¼š</div>
            <div id="o_price" style="font-weight:bold; color:#d35400;"></div>
            <span id="o_name" style="font-size: 18px; color: #d63031; font-weight: 900; display: block; margin: 5px 0;"></span>
            <div id="o_ana_lotto" style="font-size:13px; color:#555;"></div>
            
            <div class="recommend-title">ğŸ‘‡ å‚™ç”¨æ¬¾å°ˆå±¬å¹¸é‹å°¾æ•¸ ğŸ‘‡</div>
            <div style="text-align:center;"><div class="num-ball" id="o_lucky_num_2"></div></div>
        </div>
        
        <div id="o_pos" style="font-weight:bold; color:var(--gold); margin-top:15px; text-align:center; font-size:16px;"></div>
    </div>
</div>

<script>
// --- å³æ™‚è·³å‹•é›»å­é˜åŠŸèƒ½ ---
function updateRealTimeClock() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const s = String(now.getSeconds()).padStart(2, '0');
    document.getElementById('realTimeClock').innerText = `${h}:${m}:${s}`;
}

let currentMaxNum = 100;

function updateMaxNum() {
    const val = document.getElementById('tSelect').value;
    const price = parseInt(val.split('_')[0]);
    if (price === 2000) currentMaxNum = 19;
    else if (price === 1000) currentMaxNum = 25;
    else if (price === 500) currentMaxNum = 50;
    else currentMaxNum = 100; 
    
    const numInput = document.getElementById('tNum');
    numInput.max = currentMaxNum;
    if (price === 0) numInput.placeholder = `è¼¸å…¥å°¾æ•¸ 0~100 (æ²’æƒ³æ³•å¯ä¸å¡«)`;
    else numInput.placeholder = `æ­¤é¢é¡æœ€å¤š${currentMaxNum}å¼µï¼Œè¼¸å…¥ 0~${currentMaxNum}`;
}

window.onload = function() {
    // å•Ÿå‹•é›»å­é˜
    updateRealTimeClock();
    setInterval(updateRealTimeClock, 1000);

    let savedProfile = localStorage.getItem('lottoProfile');
    if (savedProfile) {
        let p = JSON.parse(savedProfile);
        if(p.name) document.getElementById('uName').value = p.name;
        if(p.gender) document.getElementById('uGender').value = p.gender;
        if(p.bd) document.getElementById('bDate').value = p.bd;
        if(p.bh) document.getElementById('bHour').value = p.bh;
    }
    updateMaxNum(); 
};

function saveHistory(targetInfo, scoreStr, color) {
    let history = JSON.parse(localStorage.getItem('lottoRecord')) || [];
    let now = new Date();
    let timeStr = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${now.getMinutes()<10?'0':''}${now.getMinutes()}`;
    history.unshift({ time: timeStr, info: targetInfo, score: scoreStr, color: color });
    if(history.length > 10) history.pop(); 
    localStorage.setItem('lottoRecord', JSON.stringify(history));
}

function toggleHistory() {
    let box = document.getElementById('historyBox');
    if (box.style.display === 'block') box.style.display = 'none';
    else { renderHistory(); box.style.display = 'block'; }
}

function renderHistory() {
    let history = JSON.parse(localStorage.getItem('lottoRecord')) || [];
    let list = document.getElementById('historyList');
    if (history.length === 0) { list.innerHTML = "<div style='color:#ccc; font-size:13px;'>ç›®å‰å°šç„¡ç´€éŒ„ã€‚</div>"; return; }
    let html = "";
    history.forEach(item => {
        html += `<div class="hist-item" style="border-left-color: ${item.color};">
                    <span class="hist-time">[${item.time}]</span> <b>${item.info}</b><br>
                    <span style="color:${item.color}; font-weight:bold;">${item.score}</span></div>`;
    });
    list.innerHTML = html;
}

function clearHistory() {
    if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿ")) { localStorage.removeItem('lottoRecord'); renderHistory(); }
}

function go() {
    const name = document.getElementById('uName').value;
    const bd = document.getElementById('bDate').value;
    const bh = parseInt(document.getElementById('bHour').value);
    const gender = document.getElementById('uGender').value;
    
    const targetVal = document.getElementById('tSelect').value;
    const [tPriceStr, tName] = targetVal.split('_');
    const tPrice = parseInt(tPriceStr); 
    const tNumInput = document.getElementById('tNum').value;
    const tNum = tNumInput ? parseInt(tNumInput) : 0;

    if (tNumInput !== "" && (tNum > currentMaxNum || tNum < 0)) {
        alert(`âš ï¸ è™Ÿç¢¼å°¾æ•¸éŒ¯èª¤ï¼\nè«‹è¼¸å…¥ 0 åˆ° ${currentMaxNum} ä¹‹é–“çš„æ•¸å­—ï¼`);
        return;
    }
    if(!name || !bd) { alert("è«‹å¡«å¯«å§“åèˆ‡ç”Ÿæ—¥å•Ÿå‹•å…¨çƒå…±æŒ¯ï¼"); return; }

    localStorage.setItem('lottoProfile', JSON.stringify({ name, gender, bd, bh }));

    const dObj = new Date(bd);
    const m = dObj.getMonth() + 1;
    const d = dObj.getDate();
    
    const now = new Date();
    let buyDateInput = document.getElementById('buyDate').value;
    let targetDateObj = buyDateInput ? new Date(buyDateInput) : now;
    
    const targetM = targetDateObj.getMonth() + 1;
    const targetD = targetDateObj.getDate();
    
    let buyHourInput = document.getElementById('buyHour').value;
    let targetH = now.getHours();
    let targetMin = now.getMinutes();
    
    const shichenNames = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
    let shichenName = "";
    
    if (buyHourInput !== "auto") {
        targetH = parseInt(buyHourInput);
        targetMin = 0; 
        shichenName = shichenNames[Math.floor(targetH/2)];
    } else {
        let sIdx = Math.floor(((targetH + 1) % 24) / 2);
        shichenName = shichenNames[sIdx];
    }

    const baseSeed = m + d + name.length + bh + targetM + targetD; 
    const itemSeed = baseSeed + tPrice + tName.length + targetH + targetMin; 

    let sEast = (m*2 + bh*3 + tNum + targetH) % 20 + 5; 
    let sWest = (name.length*5 + tPrice + tNum + targetMin) % 20 + 5;
    let sNord = (itemSeed * 13 + targetD) % 20 + 5;
    let sMaya = (baseSeed * 17 + targetM + tNum) % 20 + 5;

    const n1 = (itemSeed * 7 + 13) % (currentMaxNum + 1); 
    const altMaxArr = [19, 25, 50, 100, 100]; 
    const altItemIndex = targetH % 5;
    const bn1 = (baseSeed * 11 + targetH * 3 + 36) % (altMaxArr[altItemIndex] + 1);

    let isPerfectMatch = false;
    if (tNumInput !== "" && (tNum === n1 || tNum === bn1)) {
        sEast = 24 + (baseSeed % 2); sWest = 23 + (itemSeed % 3);
        sNord = 24; sMaya = 25;
        isPerfectMatch = true;
    }
    
    let matchScore = sEast + sWest + sNord + sMaya; 

    document.getElementById('s_east').innerText = sEast;
    document.getElementById('s_west').innerText = sWest;
    document.getElementById('s_nord').innerText = sNord;
    document.getElementById('s_maya').innerText = sMaya;

    let displayTarget = tPrice === 0 ? "ã€ç¶œåˆæ•´é«”é‹å‹¢ã€‘" : `${tPrice}å…ƒçš„ã€Œ${tName}ã€`;
    displayTarget += tNumInput ? ` (æ¸¬ç®—å°¾æ•¸ ${tNum})` : ``;
    document.getElementById('r_target_info').innerText = displayTarget;
    
    const iChing = ["ä¹¾ç‚ºå¤©(å¤§å‰)", "ç«æ°´æœªæ¿Ÿ(è½‰æ©Ÿ)", "åœ°å¤©æ³°(é€šé”)", "é›·æ°´è§£(åŒ–è§£)"];
    const tarot = ["çš‡å¸", "çš‡å", "å‘½é‹ä¹‹è¼ª", "å¤ªé™½", "ä¸–ç•Œ", "é­”è¡“å¸«"];
    const runes = ["Fehu(è²¡å¯Œ)", "Jera(è±æ”¶)", "Gebo(ç¦®ç‰©)", "Wunjo(å–œæ‚…)"];
    const mayan = ["é»ƒå¤ªé™½(å•Ÿç™¼)", "ç´…é¾(èª•ç”Ÿ)", "è—å¤œ(ç›´è¦º)", "ç™½é¢¨(éˆæ„Ÿ)", "é»ƒæ˜Ÿæ˜Ÿ(å„ªé›…)"];
    const spiritAnimal = ["è€é·¹(é è¦‹)", "ç‹¼(ç›´è¦º)", "ç†Š(åŠ›é‡)", "ç¾æ´²è±¹(è¿…æ·)"];
    
    let eTag = iChing[itemSeed % 4];
    let wTag = tarot[itemSeed % 6];
    let nTag = runes[itemSeed % 4];
    let mTag = mayan[itemSeed % 5];
    let aTag = spiritAnimal[baseSeed % 4];

    document.getElementById('o_magic_tags').innerHTML = `
        <span class="sys-tag tag-time">ğŸ•’ è³¼è²·æ™‚é–“: ${targetM}/${targetD} (${shichenName}æ™‚)</span><br>
        <span class="sys-tag tag-east">æ˜“ç¶“: ${eTag}</span>
        <span class="sys-tag tag-west">å¡”ç¾…: ${wTag}</span>
        <span class="sys-tag tag-nord">ç›§æ©: ${nTag}</span>
        <span class="sys-tag tag-maya">ç‘ªé›…: ${mTag}</span>
        <span class="sys-tag tag-maya">å°ç¬¬å®‰: ${aTag}</span>
    `;

    let scoreBox = document.getElementById('o_score_box');
    let targetAna = document.getElementById('o_target_ana');
    let scoreStr = "";
    let themeColor = "";
    
    if(matchScore >= 80) {
        themeColor = "#27ae60";
        scoreStr = `ğŸŒŸ å®‡å®™ç¸½åˆ† ${matchScore} åˆ†ï¼šè“‹äºæ¥µåº¦æ¨è–¦ï¼`;
        scoreBox.style.background = "linear-gradient(to right, #27ae60, #2ecc71)";
        targetAna.innerHTML = `${isPerfectMatch ? "<b style='color:#c0392b;'>ã€å¥‡è¹Ÿå¤§åˆç›¸ã€‘</b> è¼¸å…¥æ­£æ˜¯å®‡å®™æŒ‡å®šè™Ÿç¢¼ï¼<br>" : ""}<b>ã€æ™‚è¾°è§£æã€‘</b> åœ¨æ‚¨æŒ‡å®šçš„ <b>${shichenName}æ™‚</b>ï¼Œæ±æ–¹æ˜“ç¶“æŠ½å‡º<b>ã€Œ${eTag}ã€</b>ï¼Œè¥¿æ–¹å¡”ç¾…é¡¯ç¾<b>ã€Œ${wTag}ã€</b>ï¼Œå†åŠ ä¸Šç‘ªé›…å°è¨˜<b>ã€Œ${mTag}ã€</b>åŠ æŒã€‚æ­¤åˆ»åœ°çƒèƒ½é‡å ´èˆ‡æ‚¨å®Œç¾å¥‘åˆï¼Œå¤§è†½å‡ºæ“Šï¼`;
    } else if (matchScore >= 50) {
        themeColor = "#f39c12";
        scoreStr = `âš¡ å®‡å®™ç¸½åˆ† ${matchScore} åˆ†ï¼šå¯ä»¥ä¸€è©¦`;
        scoreBox.style.background = "linear-gradient(to right, #f39c12, #e67e22)";
        targetAna.innerHTML = `<b>ã€æ™‚è¾°è§£æã€‘</b> åœ¨æŒ‡å®šçš„ <b>${shichenName}æ™‚</b>ï¼Œå››å¤§æ³•åº­æ„è¦‹åˆ†æ­§ã€‚æ±æ–¹ç£å ´å¹³ç©©ï¼Œä½†ç›§æ©ç¬¦æ–‡æç¤ºæœ‰è®Šæ•¸ã€‚æ­¤æ™‚éœ€å€Ÿç”¨éˆç¸<b>ã€Œ${aTag}ã€</b>çš„åŠ›é‡ï¼Œè‹¥æœ‰å¼·çƒˆç›´è¦ºå¯å˜—è©¦å…¥æ‰‹ã€‚`;
    } else {
        themeColor = "#c0392b";
        scoreStr = `âš ï¸ å®‡å®™ç¸½åˆ† ${matchScore} åˆ†ï¼šå»ºè­°æ›´æ›æ™‚è¾°æˆ–è™Ÿç¢¼`;
        scoreBox.style.background = "linear-gradient(to right, #c0392b, #e74c3c)";
        targetAna.innerHTML = `<b>ã€æ™‚è¾°è§£æã€‘</b> åœ¨æŒ‡å®šçš„ <b>${shichenName}æ™‚</b>ï¼Œå››å¤§æ–‡æ˜ç³»çµ±åŒæ™‚ç™¼å‡ºè­¦è¨Šã€‚å¡”ç¾…æ˜Ÿè±¡èƒ½é‡å—é˜»ï¼Œç‘ªé›…ç£å ´æ··äº‚ã€‚<br><b>ã€å°ç­–ã€‘</b> å¼·çƒˆå»ºè­°ã€Œæ›ä¸€å€‹æ™‚è¾°ã€å†å»è²·ï¼Œæˆ–æ”¹è²·ä¸‹æ–¹å‚™ç”¨æ¬¾å¼ã€‚`;
    }
    
    scoreBox.innerHTML = scoreStr;
    const formatNum = n => n < 10 ? '0' + n : n;
    document.getElementById('t_recommend_title').innerText = tPrice === 0 ? `ğŸ‘‡ ${shichenName}æ™‚ è“‹äºæŒ‡å®šå°¾æ•¸ ğŸ‘‡` : `ğŸ‘‡ å®‡å®™ç‚ºæ­¤æ¬¾å®‰æ’çš„æœ¬å‘½å°¾æ•¸ ğŸ‘‡`;
    document.getElementById('o_lucky_num_1').innerText = formatNum(n1);

    const styles = [
        {p:"NT$ 2,000", n:"2,000è¬è¶…ç´šç´…åŒ…", a:`æ˜Ÿç›¤æœ¨æ˜Ÿå…¥è²¡å®®ï¼Œæ­é…ç‘ªé›…å°è¨˜<b>ã€Œ${mTag}ã€</b>ï¼Œå¤§çæœ€å¥‘åˆã€‚`},
        {p:"NT$ 1,000", n:"1,200è¬å¤§å‰åˆ©", a:`æ˜“æ•¸ã€Œä¹¾é‡‘ç”Ÿè²¡ã€ï¼Œå€Ÿç”¨å‹•ç‰©éˆ<b>ã€Œ${aTag}ã€</b>ï¼Œæ˜“æœ‰æ„å¤–ä¹‹å–œã€‚`},
        {p:"NT$ 500", n:"é‡‘é¦¬ç(100%ä¸­ç)", a:`æ˜Ÿç›¤é¡¯ç¤ºæ­¤æ™‚å®œç©©ï¼ŒåŒ—æ­ç¬¦æ–‡<b>ã€Œ${nTag}ã€</b>æŒ‡å¼•ä¿åº•èƒ½å®ˆè²¡ã€‚`},
        {p:"NT$ 200", n:"é‡‘é¦¬å ±å–œ", a:`æ­¤æ™‚æœ€èƒ½å¸¶å‹•æœ¬å‘½åè²¡ï¼ŒåŠ ä¸Šç‘ªé›…<b>ã€Œ${mTag}ã€</b>æŒ‡å¼•ï¼Œçˆ†ç™¼åŠ›æ¥µå¼·ã€‚`},
        {p:"NT$ 100", n:"è²¡æºæ»¾æ»¾", a:`æ˜“ç¶“ã€Œåæ°´æµå‹•ã€ï¼Œé †æ‡‰å‹•ç‰©éˆ<b>ã€Œ${aTag}ã€</b>çš„ç›´è¦ºï¼Œå°é¡å¤šé»é–‹èŠ±ã€‚`}
    ];
    const ch = styles[altItemIndex];
    document.getElementById('o_price').innerText = "å®‡å®™æŒ‡å¼•é¢é¡ï¼š" + ch.p;
    document.getElementById('o_name').innerText = ch.n;
    document.getElementById('o_ana_lotto').innerHTML = "æ˜Ÿéš›è§£æï¼š" + ch.a;

    document.getElementById('o_lucky_num_2').innerText = formatNum(bn1);

    const pos = ["æ­£æ±", "æ­£å—", "æ­£è¥¿", "æ­£åŒ—", "æ±å—", "è¥¿å—", "è¥¿åŒ—", "æ±åŒ—"];
    document.getElementById('o_pos').innerText = "ğŸ“ æœ€ä½³è²¡æ°£ç‰½å¼•æ–¹ä½ï¼šæœå‘å®¶ä¸­çš„ã€Œ" + pos[(baseSeed + targetH) % 8] + "ã€";

    document.getElementById('res').style.display = 'block';
    saveHistory(displayTarget, scoreStr, themeColor);
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
}
</script>
</body>
</html>
